<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CSS_coursework</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="css_assessment_one_quarto_files/libs/clipboard/clipboard.min.js"></script>
<script src="css_assessment_one_quarto_files/libs/quarto-html/quarto.js"></script>
<script src="css_assessment_one_quarto_files/libs/quarto-html/popper.min.js"></script>
<script src="css_assessment_one_quarto_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="css_assessment_one_quarto_files/libs/quarto-html/anchor.min.js"></script>
<link href="css_assessment_one_quarto_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="css_assessment_one_quarto_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="css_assessment_one_quarto_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="css_assessment_one_quarto_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="css_assessment_one_quarto_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CSS_coursework</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Data Exploration and Contextualization</strong></p>
<p>The dataset under analysis, ‘Vaccine Coverage and Disease Burden Statistics’, provided by the WHO, provides detailed statistics associated with a variety of diseases. The variables cover immunization rates amongst one-year-olds, disease incidence, as well as death rates across the globe’s countries and regions, recorded as values per year. For certain variables and countries, coined ’Entity’s in the dataset, the data reaches as early as 1974, and stretches until 2015. No data crosses this range. Thus, the dataset offers valuable insight into public health, proving helpful for social scientists.</p>
<p>Such a dataset can act as a key resource in research on public health’s interlink with other social factors, such as socioeconomics, psychology, culture, etc. <a href="Cohen%20et%20al.,%202006">@cohen2006</a><em>.</em> Advantageously, the dataset provides data on both immunization and incidence of certain diseases which severely impacted society, such as polio and measles. Thus, we are able to examine the correlation between immunization and incidence. Social scientists can further use this to their advantage, by examining changes in such variables and their relation with other social factors. Such research can be fed back into medicinal development, and public health related policies.</p>
<p>The means, standard deviations, and missing values were calculated using their respective functions. They were calculated for each Entity in each variable. However, due to the nature of the data being over a period of time, the insight provided by these statistics is limited. An Entity’s mean for one variable which stretches over a period of years oversimplifies the data, and does not demonstrate the changes in the variable, and thus lacks meaning. Similarly, the standard deviation, measuring dispersion from the mean, does not reveal any patterns occurring over time, thus lacking value in the given research focus.</p>
<p>The number of missing values varied between variables and entities, thus throughout the coding process missing values were always removed, in order not to skew the data.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 201 × 25
   Entity    `mean(...)` `sd(...)` sum(is.na(\BCG immun…¹ sum(is.na(\Hepatitis…²
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;                  &lt;int&gt;                  &lt;int&gt;
 1 Afghanis…   11844.      1207.                        8                     33
 2 Africa     413125      14930.                        0                     16
 3 Albania        13.9        8.75                      0                     14
 4 Algeria      2850        210.                       11                     30
 5 Americas    22875       3810.                        0                     13
 6 Andorra         0.625      0.5                      19                      0
 7 Angola      10144.      1674.                        9                     33
 8 Antigua …       1          0                        42                     27
 9 Argentina     736.        92.3                       6                     28
10 Armenia       204.        57.8                       2                     10
# ℹ 191 more rows
# ℹ abbreviated names:
#   ¹​`sum(is.na(\`BCG immunization coverage among 1-year-olds (WHO 2017)\`))`,
#   ²​`sum(is.na(\`Hepatitis B (HepB3) immunization coverage among 1-year-olds (WHO 2017)\`))`
# ℹ 20 more variables:
#   `sum(is.na(\`DTP3 immunization coverage among 1-year-olds (WHO 2017)\`))` &lt;int&gt;,
#   `sum(is.na(\`Polio (Pol3) immunization coverage among 1-year-olds (WHO 2017)\`))` &lt;int&gt;, …</code></pre>
</div>
</div>
<p><strong>Data Processing and Functional Programming</strong></p>
<p>To avoid any human error in the programming process due to the length of the dataset’s name, it was renamed to ‘ds’, and will be referred to as such from now onward.</p>
<p>As can be seen in the dataset, only two diseases have information on both immunization rates and disease incidence: polio and measles. Thus, these two diseases were selected to observe the correlation between the two variables. As shown below, to tidy the dataset for it to consist of only information needed for the final visualizations, we selected the six variables needed, and renamed those with longer names for simplicity for the remaining coding process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ds <span class="ot">&lt;-</span> ds <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Entity, Year, <span class="st">`</span><span class="at">Polio (Pol3) immunization coverage among 1-year-olds (WHO 2017)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Measles (MCV) immunization coverage among 1-year-olds (WHO 2017)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Number confirmed polio cases (WHO 2017)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Number of confirmed measles cases (WHO 2017)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">polio_imm =</span> <span class="st">`</span><span class="at">Polio (Pol3) immunization coverage among 1-year-olds (WHO 2017)</span><span class="st">`</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">measles_imm =</span> <span class="st">`</span><span class="at">Measles (MCV) immunization coverage among 1-year-olds (WHO 2017)</span><span class="st">`</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">polio_cases =</span> <span class="st">`</span><span class="at">Number confirmed polio cases (WHO 2017)</span><span class="st">`</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">measles_cases =</span> <span class="st">`</span><span class="at">Number of confirmed measles cases (WHO 2017)</span><span class="st">`</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [7,818 × 6] (S3: tbl_df/tbl/data.frame)
 $ Entity       : chr [1:7818] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ Year         : num [1:7818] 1974 1975 1976 1977 1978 ...
 $ polio_imm    : num [1:7818] NA NA NA NA NA NA NA 3 5 5 ...
 $ measles_imm  : num [1:7818] NA NA NA NA NA NA 11 NA 8 9 ...
 $ polio_cases  : num [1:7818] NA NA NA NA NA NA NA NA NA NA ...
 $ measles_cases: num [1:7818] 7 466 26 28174 43964 ...</code></pre>
</div>
</div>
<p>Due to the extensive number of countries that data is provided for within the dataset, the analysis must be narrowed down. Therefore, it was opted to select the country with the greatest range in case numbers across the years data is provided for. In a country with a large increase in case numbers, an effective immunization system is vital, thus comparing the two with each other, and a cumulative cases visualization helps evaluate whether the variables may correspond, and determine the efficacy of the immunization schedule. Additionally, focusing on a country with a large range allows for a clearer view of visual trends, further easing the comparison.</p>
<p>To achieve this, first, a function to calculate range of cases per Entity had to be written. The pre-existing range function in r returns a vector containing maximum and minimum values, however the aim is to find the difference between the maximum and minimum values, thus a new function had to be written.</p>
<p>Below, is the initial function written. While the general structure works, there is an error in code of the function’s argument. By merely making the argument ‘variable’, the input is detected as an object rather than a variable within ds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>entity_range <span class="ot">&lt;-</span> <span class="cf">function</span>(variable){ <span class="co">#defines a function with an attempt to use variable names as the argument.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  ds <span class="sc">%&gt;%</span> <span class="co">#begins data pipeline.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Entity) <span class="sc">%&gt;%</span> <span class="co">#groups the data by country.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">range =</span> <span class="fu">max</span>(variable, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(variable, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="co">#calculating the range.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#calling the function for polio cases</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>polio_cases_range <span class="ot">&lt;-</span> <span class="fu">entity_range</span>(ds<span class="sc">$</span>polio_cases)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(polio_cases_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 201 × 2
   Entity              range
   &lt;chr&gt;               &lt;dbl&gt;
 1 Afghanistan           461
 2 Africa                461
 3 Albania               461
 4 Algeria               461
 5 Americas              461
 6 Andorra               461
 7 Angola                461
 8 Antigua and Barbuda   461
 9 Argentina             461
10 Armenia               461
# ℹ 191 more rows</code></pre>
</div>
</div>
<p>Thus, another attempt is made. This function attempts to use indices as the argument, to instruct the function to access columns via their index position. However, this only returns the maximum values for each entity without providing their range in case numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>entity_range <span class="ot">&lt;-</span> <span class="cf">function</span>(i) { <span class="co">#defines a function which access columns via their index position in the dataset</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  ds <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Entity) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">range =</span> <span class="fu">max</span>(ds[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(ds[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#followed by the below for calling the function</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#function applied to polio cases</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>polio_cases_range <span class="ot">&lt;-</span> <span class="fu">entity_range</span>(<span class="dv">5</span>) <span class="co">#index position of the polio_cases column is 5</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(polio_cases_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 201 × 2
   Entity              range
   &lt;chr&gt;               &lt;dbl&gt;
 1 Afghanistan           461
 2 Africa                461
 3 Albania               461
 4 Algeria               461
 5 Americas              461
 6 Andorra               461
 7 Angola                461
 8 Antigua and Barbuda   461
 9 Argentina             461
10 Armenia               461
# ℹ 191 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#function applied to measles cases </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>measles_cases_range <span class="ot">&lt;-</span> <span class="fu">entity_range</span>(<span class="dv">6</span>) <span class="co">#index position of the polio_cases column is 6</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(measles_cases_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 201 × 2
   Entity                range
   &lt;chr&gt;                 &lt;dbl&gt;
 1 Afghanistan         4430074
 2 Africa              4430074
 3 Albania             4430074
 4 Algeria             4430074
 5 Americas            4430074
 6 Andorra             4430074
 7 Angola              4430074
 8 Antigua and Barbuda 4430074
 9 Argentina           4430074
10 Armenia             4430074
# ℹ 191 more rows</code></pre>
</div>
</div>
<p>Finally, ChatGPT is consulted in attempt to identify the issue, which proposed several alternative solutions. However, many of them utilized coding far above the module’s content level, and beyond understanding, leaving only fractions of the original code. A solution not too different from the original code was desired. Deciding to return to a code utilizing variable’s names rather than indices due to this being less prone to human error and confusion, the below code was suggested.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>entity_range <span class="ot">&lt;-</span> <span class="cf">function</span>(variable) { <span class="co">#defines a function 'entity_range' which takes variable names as the input.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  ds <span class="sc">%&gt;%</span> <span class="co">#begins data pipelin.e</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Entity) <span class="sc">%&gt;%</span> <span class="co">#groups the data by country.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">range =</span> <span class="fu">max</span>(.data[[variable]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(.data[[variable]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'summarize' creates a new summary for each entity.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'range = ' creates a column within the summary displaying the calculated range of the inputed variable by subtracting the minimum value from the maximum value of the variable.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'.data[[variable]]' provided by ChatGPT, allows functions to access variables within the dataset dynamically.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'na.rm = TRUE' removes missing values (NA) when calculation is performed.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The functions accessing variables within the dataset dynamically means it accesses the column under whichever variable name is input as the argument. If it were not dynamic, the function would be locked to one variable. Additionally, this differs from the original code written as it accesses the input as a variable rather than an object.</p>
<p>Once this function was written, it was applied to the necessary columns, as shown below. The argument must be written as a string to be recognized as a column name rather than an object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#function applied to polio cases variable</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>polio_cases_range <span class="ot">&lt;-</span> <span class="fu">entity_range</span>(<span class="st">"polio_cases"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(polio_cases_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 201 × 2
   Entity              range
   &lt;chr&gt;               &lt;dbl&gt;
 1 Afghanistan            63
 2 Africa                 42
 3 Albania                 0
 4 Algeria                 0
 5 Americas                0
 6 Andorra                 0
 7 Angola                 33
 8 Antigua and Barbuda     0
 9 Argentina               0
10 Armenia                 0
# ℹ 191 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#function applied to measles cases variable</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>measles_cases_range <span class="ot">&lt;-</span> <span class="fu">entity_range</span>(<span class="st">"measles_cases"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(measles_cases_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 201 × 2
   Entity                range
   &lt;chr&gt;                 &lt;dbl&gt;
 1 Afghanistan           43972
 2 Africa              1376172
 3 Albania              136034
 4 Algeria               29584
 5 Americas             257705
 6 Andorra                   5
 7 Angola                30038
 8 Antigua and Barbuda    2291
 9 Argentina             42093
10 Armenia                2281
# ℹ 191 more rows</code></pre>
</div>
</div>
<p>Next, we must select the Entity with the greatest range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting entity with greatest range in polio cases</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>max_range_entity_polio <span class="ot">&lt;-</span> polio_cases_range<span class="sc">%&gt;%</span> <span class="co">#assigns result of the code to a new variable "max_range_entity_polio".</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(range)) <span class="sc">%&gt;%</span> <span class="co">#arranges the entities in descending order.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="co">#selects the first row of the column</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(max_range_entity_polio) <span class="co">#returns the entity in the first row of the column, which is the one with the greatest range due to them being arranged in descending order.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  Entity     range
  &lt;chr&gt;      &lt;dbl&gt;
1 Tajikistan   460</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting entity with greatest range in measles cases</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the same code is applied as above, with one minor difference.</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>max_range_entity_measles <span class="ot">&lt;-</span> measles_cases_range <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Entity <span class="sc">!=</span> <span class="st">"World"</span>) <span class="sc">%&gt;%</span> <span class="co">#instructs to filter out the row belonging to the Entity 'World'. </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(range)) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(max_range_entity_measles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  Entity   range
  &lt;chr&gt;    &lt;dbl&gt;
1 China  3270348</code></pre>
</div>
</div>
<p>The Entity “World’ is filtered out as it originally was returned as the entity with the greatest range, however we want to focus on countries exclusively. The entities returned, Tajikistan and China, differ hugely in range. Upon observation, Tajikistan only has data for one year of polio cases, thus that value is automatically the range, which happens to be greater than the range of other countries. This lack of data can be attributed to the near eradication of polio worldwide that occurred in the late 20th century <span class="citation" data-cites="nathanson2010">(<a href="#ref-nathanson2010" role="doc-biblioref">Nathanson and Kew 2010</a>)</span>. Thus, due to the number of missing values, data visualizations for this variable would provide a lot less insight into the relationship between immunization and case numbers. Thus, we decided to focus on measles in China specifically. We tidied ds further, to remove unnecessary variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ds <span class="ot">&lt;-</span> ds <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Entity, Year, measles_cases, measles_imm) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Entity <span class="sc">==</span> <span class="st">"China"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As can be seen, China only has data from 1983 onward, so we filter those years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ds <span class="ot">&lt;-</span> ds <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year<span class="sc">&gt;</span><span class="dv">1982</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the final piece of wrangling necessary for the data visualization, an additional column is added to the dataset, displaying cumulative cases every year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ds <span class="ot">&lt;-</span> ds <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cumulative_measles_cases =</span> <span class="fu">cumsum</span>(measles_cases)) <span class="co">#calculates cumulation of cases per year</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The visualizations to be made are all scatter plots, with the same X-axis of ‘Year’, and varying Y-axes. Thus, a function was created automating plotting. Repeating the same process three times would be more time consuming and more prone to error, thus creating a function increases efficiency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>create_scatter_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(i) { <span class="co">#defines a function automating plotting a scatter plot, taking 'i' as an argument, which represents column index. </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  ds <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes_string</span>(<span class="at">x =</span> <span class="fu">names</span>(ds)[<span class="dv">2</span>], <span class="at">y =</span> <span class="fu">names</span>(ds)[i])) <span class="sc">+</span> <span class="co">#'aes_string' labels the x and y axes.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#'names(ds)[2]' attributes the x-axis to the column in ds of the second index, which is 'Year'.</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#'names(ds)[i]' attributes the y-axis to column 'i', enabling any variable within ds to be used when the function is called.</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="co">#plots each piece of data as a point on the graph, creating a scatter plot.</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>( <span class="co">#adds labels to graph</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">glue</span>(<span class="st">"{names(ds)[i]} in China per year"</span>), <span class="co">#'glue' combines objects with strings. Here, the object is 'names(ds)[i]' which allows the name of the column at the given index to be used in the title. </span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">glue</span>(<span class="st">"{names(ds)[i]}"</span>) <span class="co">#'glue' dynamically sets the y-axis label as the name of the column at the given index.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>() <span class="co">#adds a smooth line of best fit, touching all points of the graph.</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>plots_list <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(ds), create_scatter_plot) <span class="co">#creates scatter plots iterating from the third column of ds to the last one.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `aes_string()` was deprecated in ggplot2 3.0.0.
ℹ Please use tidy evaluation idioms with `aes()`.
ℹ See also `vignette("ggplot2-in-packages")` for more information.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>plots_grid <span class="ot">&lt;-</span> gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(<span class="at">grobs =</span> plots_list, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="co">#arranges plots in a grid</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'
`geom_smooth()` using method = 'loess' and formula = 'y ~ x'
`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="css_assessment_one_quarto_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Figure A (left): measles cases, Figure B (middle): measles imm, Figure C (right): cumulative measles</p>
<p><strong>Interpretation</strong></p>
<p>‘Measles Cases in China Per Year’ shows an overall negative trend, meaning the number of measles cases per year in China has decreased overall between 1983 and 2015. However, there are fluctuations within the data, with a particular plateau between 1994 and 2000, followed by a spurge, until it begins to fall again.</p>
<p>To compare Figure B with Figure A, there is an overall positive trend - measles immunization rates increase throughout the years. However, like Figure A, there are fluctuations. At approximately a similar time to the plateau in Figure A, there is a fall in immunization rates, suggesting a correlation between the two.</p>
<p>Finally, Figure C shows the cumulative cases slow near the end of the data, when the immunization rate begins to reach consistent high rates each year.</p>
<p>These trends, at first glance, although not supported by deeper statistical analyses such as regression, suggest there may be a correlation between immunization rates and disease incidence. Furthermore, the fluctuations within the trends may suggest other factors at play, such as socioeconomic, cultural, etc. Such factors have been shown to have an influence on vaccine uptake hesitancy <span class="citation" data-cites="enyinnaya2024">(<a href="#ref-enyinnaya2024" role="doc-biblioref">Enyinnaya et al. 2024</a>)</span>, which would impact disease incidence. Thus, such visualizations can be utilized by social scientists in research on public health and its relationship with other social factors.</p>
<p><strong>AI use</strong></p>
<p>Throughout the computational process, ChatGPT was used as a collaborative tool on certain occasions in various manners. Primarily, it was used to help in understanding of concepts and coding functions taught throughout the module, explaining any gaps in knowledge in a detailed but understandable manner, and making any clarifications needed. Thus, concepts taught in the module were able to be applied to the computational process with more ease. Additionally, ChatGPT was consulted when codes returned errors that were beyond understanding. The AI was able to explain a simplified meaning of the error message, as well as pointing out the problem within the code, allowing for an easier fix.</p>
<p>Decidedly, its use was most impactful in the creation of the entity_range function. While the correct approach was originally taken regarding structure, without ChatGPT’s innovative teaching of the new function ‘.data[]’, the function would ultimately have been more complex and thus prone to error, especially if indices were used. ChatGPT provided several solutions which were all considered, thus allowing for a deeper understanding of various codes, expanding the R-skillset, while ultimately providing a simpler code.</p>
<p>Few issues were encountered when communicating with ChatGPT, with the experience running smoothly overall. Issues primarily stemmed from a lack of detail in questions posed, resulting in sending several messages before receiving the desired response from ChatGPT. As a result, chat threads became long and unorganized, making finding desired information within them time-consuming.</p>
<p>In conclusion, ChatGPT aided both the computational process and learning experience, ensuring full understanding was had, helping reach the interpretation that there is a relationship between measles immunization rates, disease incidence, and cumulative cases, which can be seen via the visualisation.</p>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-enyinnaya2024" class="csl-entry" role="listitem">
Enyinnaya, Joy C., Ashley A. Anderson, Nicole C. Kelp, Marilee Long, and Colleen G. Duncan. 2024. <span>“The Social Ecology of Health Beliefs and Misinformation Framework: Examining the Impact of Misinformation on Vaccine Uptake Through Individual and Sociological Factors.”</span> <em>Vaccine</em> 42 (3): 455–63. <a href="https://doi.org/10.1016/j.vaccine.2024.01.001">https://doi.org/10.1016/j.vaccine.2024.01.001</a>.
</div>
<div id="ref-nathanson2010" class="csl-entry" role="listitem">
Nathanson, N., and O. M. Kew. 2010. <span>“From Emergence to Eradication: The Epidemiology of Poliomyelitis Deconstructed.”</span> <em>American Journal of Epidemiology</em> 172 (11): 1213–29. <a href="https://doi.org/10.1093/aje/kwq320">https://doi.org/10.1093/aje/kwq320</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>